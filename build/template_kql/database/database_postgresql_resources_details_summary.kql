${extend_resource}
| project Type, SkuName, HighAvailability, GeoRedundantBackup, Zones, SubscriptionId, Name, State, Location, ResourceGroup, ReplicationRole, Backup
| where Type == 'microsoft.dbforpostgresql/flexibleservers' 
| summarize ResourceTotal=count(Name), NotRunning=dcountif(Name, State !in~ ("ready", "paused")), NotRecommendedSKU=dcountif(Name, SkuName in~ ("standard", "basic", "burstable" )), NoAVZone=dcountif(Name, HighAvailability == "Disabled"), NoReplica=dcountif(Name, ReplicationRole != "asyncreplica"), NoGRSBackup=dcountif(Name, GeoRedundantBackup == "Disabled" or Backup =="unhealthy")