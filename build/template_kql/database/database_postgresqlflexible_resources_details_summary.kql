${extend_resource}
| project Type, SkuName, SubscriptionId, Name, State, Location, ResourceGroup, Zones, AvailabilityZone, AvailabilitySet, FaultDomain, OSDisk, ReadReplica, AutomaticFailover, MultipleWriteLocations, StorageAutogrow, ReplicationRole, GeoBackup = tolower(Backup), Environment
| where Type == 'microsoft.dbforpostgresql/flexibleservers' 
| summarize ResourceTotal=count(Name), NotRunning=dcountif(Name, State !in~ ("ready")), NotRecommendedSKU=dcountif(Name, SkuName == "burstable"), NoAVZone=dcountif(Name, AvailabilityZone == "not configured"), NoHA=dcountif(Name, AutomaticFailover == "not configured"), NoGeoBackup=dcountif(Name, GeoBackup == "disabled"), AsyncReplica=dcountif(Name, ReplicationRole == "asyncreplica"), Primary=dcountif(Name, ReplicationRole == "primary")
| extend NoReplica = Primary - AsyncReplica