${extend_resource}
| summarize asrRrotectedTotalItemCounts = count(asrId != ""), asrUnprotectedItemCounts = countif(protectionStateDescription != "Protected"), asrRelicationUnHealthyItemCounts = countif(replicationHealth != "Normal"), asrFailoverUnHealthyItemCounts = countif(failoverHealth != "Normal"), asrIsReplicationAgentUpdateRequiredItemCounts = countif(isReplicationAgentUpdateRequired == true) by Type, SkuName, Kind, SubscriptionId, Name, State, Location, ResourceGroup, Zones, AvailabilityZone, AvailabilitySet, Capacity, FaultDomain, OSDisk, ReadReplica, AutomaticFailover, MultipleWriteLocations, StorageAutogrow, ReplicationRole, Backup, Environment
| where asrRrotectedTotalItemCounts != 0
| project Name, Type, SkuName, Kind, SubscriptionId, State, Location, ResourceGroup, Zones, AvailabilityZone, AvailabilitySet, Capacity, FaultDomain, OSDisk, ReadReplica, AutomaticFailover, MultipleWriteLocations, StorageAutogrow, ReplicationRole, Backup = tolower(Backup), asrRrotectedTotalItemCounts,asrUnprotectedItemCounts, asrRelicationUnHealthyItemCounts, asrFailoverUnHealthyItemCounts, asrIsReplicationAgentUpdateRequiredItemCounts, Environment
| where Type == 'microsoft.recoveryservices/vaults'
